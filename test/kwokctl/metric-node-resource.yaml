kind: Metric
apiVersion: kwok.x-k8s.io/v1alpha1
metadata:
  name: resource-default
spec:
  path: "/metrics/nodes/{nodeName}/metrics/resource"
  metrics:
  - name: scrape_error
    dimension: node
    help: "[ALPHA] 1 if there was an error while getting metrics from the node, 0 otherwise"
    kind: gauge
    value: '0'
  - name: container_start_time_seconds
    dimension: container
    help: "[ALPHA] Start time of the container since unix epoch in seconds"
    kind: gauge
    labels:
    - name: container
      value: 'container.name'
    - name: namespace
      value: 'pod.metadata.namespace'
    - name: pod
      value: 'pod.metadata.name'
    value: 'pod.SinceSecond()'

  # CPU
  - name: container_cpu_usage_seconds_total
    dimension: container
    help: "[ALPHA] Cumulative cpu time consumed by the container in core-seconds"
    kind: counter
    labels:
    - name: container
      value: 'container.name'
    - name: namespace
      value: 'pod.metadata.namespace'
    - name: pod
      value: 'pod.metadata.name'
    value: 'pod.SinceSecond() / 10.0'
  - name: pod_cpu_usage_seconds_total
    dimension: pod
    help: "[ALPHA] Cumulative cpu time consumed by the pod in core-seconds"
    kind: counter
    labels:
    - name: namespace
      value: 'pod.metadata.namespace'
    - name: pod
      value: 'pod.metadata.name'
    # TODO: sum(container_cpu_usage_seconds_total) by (pod)
    value: 'pod.SinceSecond()'
  - name: node_cpu_usage_seconds_total
    dimension: node
    help: "[ALPHA] Cumulative cpu time consumed by the node in core-seconds"
    kind: counter
    # TODO: sum(pod_cpu_usage_seconds_total) by (node)
    value: '10.0 * node.SinceSecond()'

  # Memory
  - name: container_memory_working_set_bytes
    dimension: container
    help: "[ALPHA] Current working set of the container in bytes"
    kind: gauge
    labels:
    - name: container
      value: 'container.name'
    - name: namespace
      value: 'pod.metadata.namespace'
    - name: pod
      value: 'pod.metadata.name'
    value: '1024.0 * 1024.0 * 1024.0'
  - name: pod_memory_working_set_bytes
    dimension: pod
    help: "[ALPHA] Current working set of the pod in bytes"
    kind: gauge
    labels:
    - name: namespace
      value: 'pod.metadata.namespace'
    - name: pod
      value: 'pod.metadata.name'
    # TODO: sum(container_memory_working_set_bytes) by (pod)
    value: '10.0 * 1024.0 * 1024.0 * 1024.0'
  - name: node_memory_working_set_bytes
    dimension: node
    help: "[ALPHA] Current working set of the node in bytes"
    kind: gauge
    # TODO: sum(pod_memory_working_set_bytes) by (node)
    value: '100.0 * 1024.0 * 1024.0 * 1024.0'
